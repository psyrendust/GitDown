<!doctype html>
<html lang="en" class="no-js">
<head>
	<title>AirMarkdown</title>
	<link rel="stylesheet" href="resources/css/style.css?v=2">
	<link rel="stylesheet" href="resources/css/custom.css?v=1">

	<script src="resources/js/libs/modernizr-1.7.min.js"></script>
	<script src="resources/js/AIRAliases.js"></script>
	<script src="resources/js/upskirt.js"></script>
	<script src="resources/js/upskirt_ems.js"></script>
	<script src="resources/js/libs/jquery-1.6.2.min.js"></script>
	<script src="resources/js/plugins.js"></script>
	<script>
		var airMarkdown_currentFile; // The current file in the editor.
		var airMarkdown_stream; // A FileStream object, used to read and write files.
		var airMarkdown_defaultDir; // The default directory location.
		var airMarkdown_chooserMode; // Whether the FileChooser.html window is used as an Open or Save As window.
		var airMarkdown_string;
		var foo;
		
		/**
		 * Initializes the UI.
		 */
		function airMarkdown_init() {
			airMarkdown_defaultDir = air.File.userDirectory;
			$('#airMarkdown_selectMarkdownBtn').click(function(){
				airMarkdown_openFileDB();
			});
			$('#airMarkdown_refreshBtn').css('opacity', '0.5').unbind('click');
			$(window).bind('focus', function(){
				airMarkdown_refresh();
			});
			foo = new air.NativeMenuItem("Foo Bar Deluxe");
		}
		
		/**
		 * Refreshes the current file.
		 */
		
		function airMarkdown_refresh() {
			if(!airMarkdown_stream) return;
			airMarkdown_stream = new air.FileStream();
			try 
			{
				airMarkdown_stream.open(airMarkdown_currentFile, air.FileMode.READ);
				airMarkdown_string = airMarkdown_stream.readUTFBytes(airMarkdown_stream.bytesAvailable);
				airMarkdown_stream.close();
				$("#airMarkdown_main").empty().append(markdown(airMarkdown_string));
				document.title = "AirMarkdown - " + airMarkdown_currentFile.name + " - updated: " + getCurrentTime();
			} 
			catch(error) 
			{
				airMarkdown_ioErrorHandler(error);
			}
		}
		
		/**
		 * Displays the FileChooser.html file in a new window, and sets its mode to "Open".
		 */
		function airMarkdown_openFileDB() {
			var airMarkdown_fileChooser;
			if(airMarkdown_currentFile)
			{
				airMarkdown_fileChooser = airMarkdown_currentFile;
			}
			else
			{
				airMarkdown_fileChooser = airMarkdown_defaultDir;
			}
			airMarkdown_fileChooser.browseForOpen("Open");
			airMarkdown_fileChooser.addEventListener(air.Event.SELECT, airMarkdown_openFile);
		}

		/**
		 * Opens and reads a file. 
		 */
		function airMarkdown_openFile(event) {
			airMarkdown_stream = new air.FileStream();
			try 
			{
				airMarkdown_currentFile = event.target;
				airMarkdown_stream.open(airMarkdown_currentFile, air.FileMode.READ);
				var str = airMarkdown_stream.readUTFBytes(airMarkdown_stream.bytesAvailable);
				airMarkdown_stream.close();
				$("#airMarkdown_main").empty().append(markdown(str));
				document.title = "AirMarkdown - " + airMarkdown_currentFile.name + " - updated: " + getCurrentTime();
				$('#airMarkdown_refreshBtn').css('opacity', '1').click(function(){
					airMarkdown_refresh();
				});
			} 
			catch(error) 
			{
				airMarkdown_ioErrorHandler(error);
			}
			event.target.removeEventListener(air.Event.SELECT, airMarkdown_openFile); 
			
		}

		/**
		 * Displays the "Save As" dialog box.
		 */
		function airMarkdown_saveAs() {
			var airMarkdown_fileChooser;
			if(airMarkdown_currentFile)
			{
				airMarkdown_fileChooser = airMarkdown_currentFile;
			}
			else
			{
				airMarkdown_fileChooser = airMarkdown_defaultDir;
			}
			airMarkdown_fileChooser.browseForSave("Save");
			airMarkdown_fileChooser.addEventListener(air.Event.SELECT, airMarkdown_saveAsSelectHandler);
		}	
		function airMarkdown_saveAsSelectHandler(event) {
			airMarkdown_currentFile = event.target;
			event.target.removeEventListener(air.Event.SELECT, airMarkdown_saveAsSelectHandler);
			airMarkdown_saveFile();
		}

		/**
		 * Opens and saves a file with the data in the mainText textArea element. 
		 * Newline (\n) characters in the text are replaced with the 
		 * platform-specific line ending character (File.lineEnding), which is the 
		 * line-feed character on Mac OS and the carriage return character followed by the 
		 * line-feed character on Windows.
		 */
		function airMarkdown_saveFile() {
			if (airMarkdown_currentFile == null) 
			{
				airMarkdown_saveAs();
			} 
			else 
			{
				try 
				{
					airMarkdown_stream = new air.FileStream();
					airMarkdown_stream.open(airMarkdown_currentFile, air.FileMode.WRITE);
					// var outData = document.getElementById("mainText").value;
					// outData = outData.replace(/\n/g, air.File.lineEnding);
					var outData = markdown(airMarkdown_string);
					airMarkdown_stream.writeUTFBytes(outData);
					airMarkdown_stream.close();
					//document.title = "Text Editor - " + currentFile.name;
				} 
				catch(error) 
				{
					airMarkdown_ioErrorHandler(error);
				}
			}
		}		

		/**
		 * Error message for file I/O errors. 
		 */
		function airMarkdown_ioErrorHandler(error) {
			// alert("Error reading or writing the file.", error);
		}
		function openBrowser(_url) {
			var _urlReq = new air.URLRequest(_url); 
			air.navigateToURL(_urlReq);
		}
		function openCheatSheet() {
			var initOptions = new air.NativeWindowInitOptions();
			initOptions.maximizable = false;
			initOptions.resizable = false;
			var screenWidth = 826;
			var screenHeight = 565;
			var bounds = new air.Rectangle(Math.round((screen.width-screenWidth)/2), Math.round((screen.height-screenHeight)/2), screenWidth, screenHeight);
			var html2 = air.HTMLLoader.createRootWindow(true, initOptions, false, bounds);
			var urlReq2 = new air.URLRequest("resources/cheatSheet.html");
			html2.load(urlReq2);
			html2.stage.nativeWindow.activate();
		}
		function getCurrentTime(){
			var date = new Date();
			var hours = date.getHours();
			var mins = date.getMinutes();
			var secs = date.getSeconds();
			var time = "am";
			if(hours == 0){
				hours = 12;
				time = "AM";
			}else if(hours > 11){
				hours = hours - 12;
				time = "PM";
			}
			if(mins < 10){
				mins = "0" + mins;
			}
			if(secs < 10){
				secs = "0" + secs;
			}
			return hours + ":" + mins + ":" + secs + " " + time;
		}
		function airMarkdown_loadHelp(){
			$('#airMarkdown_main').load('resources/help.txt');
		}
	</script>
</head>
<body onLoad="airMarkdown_init();">
	<div id="airMarkdown_container">
		<header id="airMarkdown_menu">
			<a id="airMarkdown_selectMarkdownBtn" class="custom-button"><span>Select Markdown File</span></a>&nbsp;&nbsp;<a id="airMarkdown_refreshBtn" class="custom-button"><span>Refresh</span></a>&nbsp;&nbsp;<a id="airMarkdown_cheatSheetBtn" class="custom-button" onClick="openCheatSheet();"><span>Markdown Cheat Sheet</span></a>&nbsp;&nbsp;<a id="airMarkdown_helpBtn" class="custom-button" onClick="airMarkdown_loadHelp();"><span>Help</span></a><span class="acknowledgement">created by <a href="javascript:void(0);" onClick="openBrowser('https://github.com/psyrendust/');">psyrendust</a> | powered by <a href="javascript:void(0);" onClick="openBrowser('https://github.com/tanoku/jsupskirt');">jsupskirt</a> & <a href="javascript:void(0);" onClick="openBrowser('https://github.com');">GitHub</a></span>
		</header>

		<div class="wikistyle" id="airMarkdown_main" role="main">
			<h2>About</h2>
			<p>
				AirMarkdown is an Air application that provides a simulated live preview of <a href="javascript:void(0);" onClick="openBrowser('http://github.github.com/github-flavored-markdown/');">GitHub Flavored Markdown</a>.
			</p>
			<h2>Usage</h2>
			<p>
				<h4>Open</h4>
				To open a markdown formatted document click on the <a id="airMarkdown_selectMarkdownBtn2" onClick="airMarkdown_openFileDB();" class="custom-button"><span>Select Markdown File</span></a> button.<br/><br/>
				<h4>Refresh</h4>
				To view changes that you have made to your document click on the <a id="airMarkdown_refreshBtn2" onClick="airMarkdown_refresh();" class="custom-button"><span>Refresh</span></a> button. A document refresh will also occur when AirMarkdown regains application focus.<br/><br/>
				<h4>Markdown Cheat Sheet</h4>
				To view a cheat sheet of markdown syntax click on the <a id="airMarkdown_cheatSheetBtn2" class="custom-button" onClick="openCheatSheet();"><span>Markdown Cheat Sheet</span></a> button.
			</p>
			<h2>Acknowledgement</h2>
			<p>
				The styling for this application is modeled after <a href="javascript:void(0);" onClick="openBrowser('https://github.com');">GitHub's</a> UI. The Markdown Cheat Sheet is taken from <a href="javascript:void(0);" onClick="openBrowser('http://github.github.com/github-flavored-markdown/');">GitHub's MCS</a>. The markdown processing is handled by <a href="javascript:void(0);" onClick="openBrowser('https://github.com/tanoku');">tanoku's</a> javascript translation of Upskirt called <a href="javascript:void(0);" onClick="openBrowser('https://github.com/tanoku/jsupskirt');">jsupskirt</a>. Unfortunately all references to the Upskirt library have been removed from <a href="javascript:void(0);" onClick="openBrowser('https://github.com');">GitHub</a>.
			</p>
			<h2>License</h2>
			<p>
				<a rel="license" href="javascript:void(0);" onClick="openBrowser('http://creativecommons.org/licenses/by-nc-sa/3.0/');"><img alt="Creative Commons License" style="border-width:0" src="/resources/images/80x15.png" /></a><br />
				This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License. To view a copy of this license, visit <a href="javascript:void(0);" onClick="openBrowser('http://creativecommons.org/licenses/by-nc-sa/3.0/');">http://creativecommons.org/licenses/by-nc-sa/3.0/</a> or send a letter to Creative Commons, 444 Castro Street, Suite 900, Mountain View, California, 94041, USA.
			</p>
			<h2>Known Bugs</h2>
			If a link is clicked where the target is set to self, the apps window will redirect to that web page. Currently there are no controls to reset the app window. You will have to restart the app to exit out of this scenario.
			<hr/>
			<p>
				In this implementation of jsupskirt the parsing of the following markdown syntax is not supported and will break the rendering.
				<h5>Use of multiple Grave accents to encapsulate code blocks is not supported.</h5>
<pre>
```
function foo(){
	return "bar";
}
```
</pre>
				<h5>Use of multiple Grave accents with language type to encapsulate code blocks is not supported.</h5>
<pre>
```javascript
function foo(){
	return "bar";
}
```
</pre>
				<h5>Use of <code>&lt;pre&gt;</code> tags is not supported.</h5>
<pre>
&lt;pre&gt;
function foo(){
	return "bar";
}
&lt;/pre&gt;
</pre>
				<h5>Use of <code>&lt;code&gt;</code> tags is not supported.</h5>
<pre>
&lt;code&gt;
function foo(){
	return "bar";
}
&lt;/code&gt;
</pre>
			</p>
		</div>
	</div>
</body>
</html>